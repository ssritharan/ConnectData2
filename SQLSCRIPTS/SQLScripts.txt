--see how many customers are in our table:
select count(*) as "Customer Count" from customers;

--how many unique companies are in our table?
select count(distinct company)as "Distinct Companies" from customers ;

--add a column for the CompanyID to the customers table
alter table customers add CompanyID int;

--notice that the companyId is null
select companyID, company from customers order by company;

--create a table for the companies
--this statement will also create a companyID column which will
--increment when you insert a new record
create table Company (
companyID number generated by default on null as identity,
Company varchar(50)
);

--see what's in your companies table now
select * from Company;

--add a test company to verify that the identity field works
insert into company(Company)values ('Dave Company');

--add unique companies from customers to the company table
insert into Company (Company) select distinct company from customers;

--look at what you've done
select count(*) from Company;
--another way to select is to list the fields
select companyID, Company from customers;

commit;

--update the compnayId in the customers table
update customers c set c.companyID = (select t.companyID from
Company t where t.company=c.company);

--query to check your data
select c.companyID,c.company,t.companyID,t.Company from
customers c inner join Company t on c.CompanyID=t.CompanyID;

--remove the company column from the customers table. It is no longer needed
alter table customers drop column company;

alter table customers drop column companyid_1;

--notice you won't see the company column
select * from customers;

-- a query to bring it all back together
select fullname, company from customers
inner join company on 
customers.companyid=company.companyid;

alter table Position add Position varchar(100);
alter table Position drop column Position;

select * from Position;

alter table City add City varchar(50);
alter table City drop column company;

select * from City;

alter table State add State varchar(50);
alter table State drop column company;

select * from State;

create table State (
StateID number generated by default on null as identity,
State varchar(50)
);

alter table Customers add ZIP2 varchar(20);

, add PositionID number, add StateID number;
alter table City drop column company;

select * from customers

--add unique Position from customers to the Position table
insert into Position (Position) select distinct Position from customers;

--update the compnayId in the customers table
update customers c set c.PositionID = (select t.PositionID from
Position t where t.position=c.position);

update customers set zip2 = zipcode;

Select * from Position

Select * from City
--add unique City from customers to the City table
insert into City (City) select distinct City from customers;

--update the cityId in the customers table
update customers c set c.CityID = (select t.CityID from
City t where t.City =c.City);


Select * from State
--add unique City from customers to the City table
insert into State (state) select distinct State from customers;

--update the cityId in the customers table
update customers c set c.StateID = (select t.StateID from
State t where t.State =c.State);

alter table Customers drop column City;

Select count(*) from new_Customers;
Select count(*) from Customers;
select * from Position

select c.customerID, c.PositionID, t.positionID, t.Position from
customers c inner join Position t on c.PositionID=t.PositionID;

desc customers;

alter table customers add CustomerID number;

update customers set customerid=rownum;

CREATE TABLE new_customers
AS
SELECT *
  FROM new_CUSTOMERS2;
  
select count(*) from new_customers;

select * from new_customers;

  CREATE TABLE new_CUSTOMERS2
   (	
   	"CUSTOMERID" NUMBER,
   "FULLNAME" VARCHAR2(22 BYTE), 
	"TITLE" VARCHAR2(4 BYTE), 
	"FIRSTNAME" VARCHAR2(11 BYTE), 
	"LASTNAME" VARCHAR2(12 BYTE), 
	"STREETADDRESS" VARCHAR2(29 BYTE), 
	"ZIPCODE" VARCHAR2(7 BYTE), 
	"EMAILADDRESS" VARCHAR2(36 BYTE), 
	"COMPANYID" NUMBER(*,0), 
	"CITYID" NUMBER, 
	"POSITIONID" NUMBER, 
	"STATEID" NUMBER
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
  
  select *  from new_CUSTOMERS2 order by customerid;

desc new_customers2;

insert into new_customers2 
(CUSTOMERID,     
FULLNAME,
TITLE ,
FIRSTNAME ,
LASTNAME,
STREETADDRESS,
ZIPCODE, 
EMAILADDRESS,
COMPANYID,
CITYID,      
POSITIONID,      
STATEID)
  select CUSTOMERID,     
FULLNAME,
TITLE ,
FIRSTNAME ,
LASTNAME,
STREETADDRESS,
ZIPCODE, 
EMAILADDRESS,
COMPANYID,
CITYID,      
POSITIONID,     
STATEID from customers;

select Fullname, PositionID from Customers where customerid > 700

select Fullname, PositionID, zipcode, zip2 from Customers where customerid > 700

UPDATE customers
SET zip2 = CAST(zip2 AS INT)
